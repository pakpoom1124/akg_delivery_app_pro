<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>บันทึกของเสีย (Wasted)</title>
  <!-- Bootstrap CSS and Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- Sarabun Font -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
      font-family: 'Sarabun', sans-serif;
      padding: 20px;
    }
    .card-container {
      /* ปรับความกว้างสูงสุดของการ์ดให้ใหญ่ขึ้น เพื่อให้ตารางด้านล่างมีพื้นที่มากขึ้น */
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 2rem;
      box-shadow: 0 8px 40px rgba(0,0,0,0.09);
      padding: 2rem;
    }
    .card-container h2 {
      font-size: 2rem;
      font-weight: 700;
      color: #bfa14c; /* gold */
      margin-bottom: 1rem;
    }
    .table th {
      background: #825ee4;
      color: #fff;           
  }
    /* จัดรูปแบบหัวตารางให้ไม่ตัดบรรทัด และให้ตัวอักษรหนาขึ้นเล็กน้อย */
    .table thead th {
      white-space: nowrap;
      font-weight: 600;
      vertical-align: middle;
    }

    /* ควบคุมความกว้างขั้นต่ำของแต่ละคอลัมน์หลักในตารางด้านล่าง
       ถ้าต้องการให้กว้าง/แคบลง สามารถปรับค่า min-width ที่นี่ได้ */
    .col-item-code {
      min-width: 90px;
    }

    .col-item-name {
      min-width: 260px;
    }

    .col-activity {
      min-width: 140px;
    }

    .col-qty {
      min-width: 120px; /* ขยายช่องจำนวนให้กว้างขึ้นประมาณ 10% */
    }

    .col-note {
      min-width: 220px;
    }

    .col-file {
      min-width: 260px;
    }
    .btn-save {
      background: linear-gradient(90deg, #5e72e4 0%, #825ee4 100%);
      border: none;
      color: #fff;
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      border-radius: 1.5rem;
      transition: background 0.2s;
    }
    .btn-save:hover {
      background: linear-gradient(90deg, #7b83eb 0%, #a88fed 100%);
      color: #fff;
    }
    .link-btn {
      color: #5e72e4;
      font-size: 1rem;
      text-decoration: none;
      margin-left: 0.75rem;
    }
    .link-btn:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="card-container">
    <h2>บันทึกของเสีย (Wasted)</h2>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning">{{ messages[0] }}</div>
      {% endif %}
    {% endwith %}
    <form method="post" enctype="multipart/form-data">
      <div class="row mb-3">
        <div class="col-md-4 col-12 mb-2">
          <label class="form-label">Date:</label>
          <input type="date" name="date" class="form-control" value="{{ nowdate }}" required>
        </div>
        <div class="col-md-4 col-12 mb-2">
          <label class="form-label">Branch:</label>
          <select name="branch" class="form-select" required>
            <option value="">-- เลือกสาขา --</option>
            {% for bid, bname in branches %}
              <option value="{{ bname }}">{{ bid }} - {{ bname }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4 col-12 mb-2">
          <label class="form-label">ประเภทกิจกรรม:</label>
          <!-- NOTE:
               ส่งค่า activity เป็น 'Wasted' เพื่อให้รายงาน receipts สามารถ filter ตามประเภทนี้ได้ตรงกับข้อมูลในตาราง item_wasted -->
          <input type="hidden" name="activity" value="Wasted">
          <select class="form-select" disabled>
            <option selected>บันทึกของเสีย (Wasted)</option>
          </select>
          <div class="form-text">ระบบจะบันทึกประเภทกิจกรรมเป็น Wasted</div>
        </div>
      </div> 
      <div class="table-responsive">
        <!-- ตารางหลักของการบันทึกของเสีย ใช้ table-sm เพื่อลดความสูงแต่ละแถวให้ดูแน่นขึ้น -->
        <table class="table table-bordered table-sm align-middle">
          <thead>
            <!-- กำหนด class ของหัวคอลัมน์ให้สอดคล้องกับ CSS ด้านบน เพื่อคุมความกว้างแต่ละคอลัมน์ -->
            <tr>
              <th class="col-item-code">รหัสวัตถุดิบ</th>
              <th class="col-item-name">รายการวัตถุดิบ</th>
              <th class="col-activity">ประเภทกิจกรรม</th>
              <!-- ใส่ class="col-qty" เพื่อขยายความกว้างคอลัมน์จำนวน -->
              <th class="col-qty">จำนวน</th>
              <th>หน่วย</th>
              <th class="col-note">หมายเหตุ</th>
              <th class="col-file">แนบไฟล์ (ถ้ามี)</th>
            </tr>
          </thead>
          <tbody>
  <tr class="table-light">
    <!-- <td colspan="7" class="small text-muted">
      แนบไฟล์ได้: pdf, jpg, jpeg, png, xlsx, xls, csv (หนึ่งไฟล์ต่อรายการ)
    </td> -->
  </tr>
            <!-- loop แสดงรายการวัตถุดิบแต่ละตัว พร้อมช่องกรอกจำนวน/หมายเหตุ/แนบไฟล์ -->
            {% for code, name, unit in items %}
            <tr>
              <td class="col-item-code">{{ code }}</td>
              <td class="col-item-name">{{ name }}</td>
              <td class="col-activity">{{ selected_activity_label|default('บันทึกของเสีย (Wasted)') }}</td>
              <!-- ใส่ class="col-qty" กับเซลล์จำนวนเพื่อให้กว้างขึ้นสอดคล้องกับหัวคอลัมน์ -->
              <td class="col-qty">
                <input type="number" step="0.001" min="0" name="qty_{{ code }}" class="form-control">
              </td>
              <td>{{ unit }}</td>
              <td class="col-note">
                <input type="text" name="note_{{ code }}" class="form-control" placeholder="เช่น lot, ใบกำกับภาษี หรือเหตุผลของเสีย">
              </td>
              <td class="col-file">
                <input type="file" name="file_{{ code }}" class="form-control" accept=".pdf,.jpg,.jpeg,.png,.xlsx,.xls,.csv">
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    <button type="submit" class="btn-save">Save</button>
    <p class="mt-3">
      <!-- <a href="{{ url_for('items_list') }}" class="link-btn">Edit Item Master</a>
      <span>|</span> -->
      <a href="{{ url_for('receipts') }}" class="link-btn">รายงาน / Export</a>
      <span>|</span>
      <!-- ปุ่มกลับหน้า Home แบบลอยซ้ายล่าง -->
         <a href="{{ url_for('home') }}" class="link-btn">
            <i class="bi bi-house-door"></i>
        กลับหน้า Home
        </a>
    </p>
    </form>
  </div>
</body>
</html>