<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>AKG Branches</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Sarabun Font -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{
      background:linear-gradient(135deg,#f8fafc 0%,#e0e7ff 100%);
      font-family:'Sarabun',sans-serif;
      padding:20px;
    }
    .card-container{
      max-width:1200px;margin:0 auto;background:#fff;border-radius:2rem;
      box-shadow:0 8px 40px rgba(0,0,0,.09);padding:2rem;
    }
    h2{font-size:2rem;font-weight:700;color:#bfa14c;margin-bottom:1rem}
    .btn-gradient{
      background:linear-gradient(90deg,#5e72e4 0%,#825ee4 100%);border:none;color:#fff;
      padding:.45rem 1.2rem;border-radius:1.5rem;transition:background .2s
    }
    .btn-gradient:hover{background:linear-gradient(90deg,#7b83eb 0%,#a88fed 100%)}
    .btn-delete{background:#e3342f;color:#fff;padding:.35rem 1rem;border-radius:1.5rem;border:none}
    .btn-delete:hover{background:#c53030}
    .link-btn{color:#5e72e4;text-decoration:none;margin-left:.75rem}
    .link-btn:hover{text-decoration:underline}
    .table th{background:#825ee4;color:#fff}
    .table th,
    .table td{
      font-size:0.95rem;
      padding:.55rem .75rem;
      white-space:nowrap;
    }
    /* ให้ชื่อสาขาสามารถตัดบรรทัดได้ เพื่อไม่ให้คอลัมน์อื่นเบียดกัน */
    .table td:nth-child(2){
      white-space:normal;
    }
  </style>
</head>
<body>
  <div class="card-container">
    <h2>ตารางสาขา (AKG_Branches)</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning">
          {% for m in messages %}{{ m }}<br>{% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- ฟอร์มเพิ่มสาขา -->
    <form method="post" class="mb-4">
      <fieldset class="border p-3 rounded-3">
        <legend class="float-none w-auto px-2" style="color:#5e72e4;font-weight:600;">เพิ่มสาขา</legend>
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label">รหัสสาขา:</label>
            <input type="number" name="branch_id" class="form-control" required>
          </div>
          <div class="col-md-7">
            <label class="form-label">ชื่อสาขา:</label>
            <input name="branch_name" class="form-control" placeholder="เช่น AKG-SPG" required>
          </div>
          <div class="col-md-1 d-flex align-items-end">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="active" name="is_active" checked>
              <label class="form-check-label" for="active">ใช้งาน</label>
            </div>
          </div>
          <div class="col-md-1 d-flex align-items-end">
            <button class="btn-gradient" type="submit">Save</button>
          </div>
        </div>
      </fieldset>
    </form>

    <!-- ตารางรายการสาขา -->
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>รหัส</th>
            <th>ชื่อสาขา</th>
            <th>สถานะ</th>
            <th>จัดการ</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <!-- คาดว่า SELECT branch_id, branch_name, is_active FROM AKG_Branches ORDER BY branch_id -->
          <tr>
            <td>{{ r[0] }}</td>
            <td>{{ r[1] }}</td>
            <td>{{ 'ใช้งาน' if r[2] else 'ปิด' }}</td>
            <td>
              <a class="btn btn-sm btn-gradient me-1" href="{{ url_for('branches_edit', branch_id=r[0]) }}">Edit</a>
              <form action="{{ url_for('branches_delete', branch_id=r[0]) }}" method="post" style="display:inline" onsubmit="return confirm('ลบสาขานี้?')">
                <button class="btn btn-sm btn-delete" type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p class="mt-3">
      <a href="{{ url_for('items_list') }}" class="link-btn">ไป Item Master</a>
      <span>|</span>
      <a href="{{ url_for('home') }}" class="link-btn">กลับหน้า Home</a>
    </p>
  </div>
</body>
</html>